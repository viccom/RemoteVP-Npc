# Vserial 虚拟串口用户手册

---------------------

## 功能描述

远程编程技术意指在远离设备的情况下，通过某种手段对远程的PLC或其他设备进行编程监控，
然后根据监控数据对程序进行修改控制。FreeIOE的远程编程分为基于网络的远程编程和基于串口的远程编程。
本文是对基于串口的远程编程功能进行介绍和说明的文章。

通过基于网络的远程编程，你可以体验到如下功能：

1. 如同在本地局域网连接现场设备一样的体验（注：由于上网网速的影响，可能交互速度稍慢）

2. 和现场设备的连接完全是按需连接，需要时开启，不需要时关闭。

3. 整个过程全程加密压缩，既省流量，又安全可靠。


## 整体构成

现场的网关和编程软件所在电脑因为大多数情况下都位于内网环境中，并无互联网上的IP地址，因此是双方是无法直接连接的，因此我们在互联网上搭建了一系列的远程编程服务节点将现场的网关和编程软件电脑连接到一起。

由于现场的网关和编程软件电脑都能访问到远程编程服务节点，因此双方带着特殊标识信息连接到响应速度最快的远程编程服务节点时，服务节点会为双方建立一个加密压缩的专用通道，将网关中的物理串口（连接现场设备）虚拟到编程软件所在电脑中。


![系统架构](static/imgs/system-topo.png)


##  准备工作

1. 在PC电脑上安装本软件。

2. 有一台内置了 [FreeIOE](https://freeioe.org) 软件的网关

3. 在互联网上部署了 [NPS](https://github.com/ehang-io/nps) 软件，并开启NPS对外提供的服务端口。

## 部署 NPS 服务

* 从GitHub下载 [NPS](https://github.com/ehang-io/nps)  最新版，按照官方教程进行安装。也可通过配置好的压缩包 [NPSX64](https://thingscloud.oss-cn-beijing.aliyuncs.com/download/nps/nps.zip) 解压并安装。

* 将配置好的压缩包中的配置文件 conf/nps.conf 覆盖目标文件夹中的同名文件，按照要求，修改nps.conf文件中的auth_key和auth_crypt_key。修改后需重新编译生成二进制发布包。

* 在部署 NPS 服务的云服务器开放nps配置文件中定义的端口 bridge_port (访问端口) 和 web_port （API端口），以及端口范围 allow_ports （可用的端口映射范围）。

## 网关连接到冬笋云

* 注册用户

* 绑定网关到用户

* 生成Access-Key

以上步骤可参考冬笋云平台的 [用户帮助](http://help.cloud.thingsroot.com/guide/quick_start) 。


## 虚拟串口页面操作说明

虚拟串口操作页面提供的示例功能如下图所示：

![系统架构](static/imgs/vser-page1.png)

页面主视图从上到下提供如下信息：

* 用户网关列表，授权文本框中填入用户的AccessKey后，可点击网关列表。

* 当前选中网关信息及所需依赖检查。

* 所需信息的输入框，包含：NPS API URL地址； NPS用户； 网关连接远程设备的串口； 用户AccessKey。

* 本地服务反馈的后台信息。

* API执行反馈和后台周期广播的状态信息。


